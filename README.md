# SECATS-威胁样本测试工具

> **免责声明**：本工具的使用仅限于合法用途，所有与本工具相关的使用行为需符合所在国家或地区的法律法规。任何非法或恶意使用行为均与开发者无关，用户应自行承担法律责任。

本工具集成了令牌桶算法、代理池管理、HTTP会话管理和网络测试功能，适用于网络请求限速、代理池管理和监控。

---

## 目录

1. [工具功能和亮点](#工具功能和亮点)
2. [应用场景](#应用场景)
3. [模块详解](#模块详解)
   - [令牌桶算法和速率限制器](#令牌桶算法和速率限制器)
   - [代理池管理器](#代理池管理器)
   - [HTTP 会话管理](#http-会话管理)
   - [威胁样本生成与解析](#威胁样本生成与解析)
   - [网络请求发送与代理使用](#网络请求发送与代理使用)
4. [主程序流程](#主程序流程)
---

## 工具特性

```auto
root@xxxxxxxxxxx:~# python3 SeCats.py

███████╗███████╗ ██████╗  █████╗ ████████╗███████╗
██╔════╝██╔════╝██╔════╝ ██╔══██╗╚══██╔══╝██╔════╝
███████╗█████╗  ██║  ███╗███████║   ██║   ███████╗ 
╚════██║██╔══╝  ██║   ██║██╔══██║   ██║   ╚════██║
███████║███████╗╚██████╔╝██║  ██║   ██║   ███████╗
╚══════╝╚══════╝ ╚═════╝ ╚═╝  ╚═╝   ╚═╝   ╚══════╝ By atangccc-Setoi

2024-11-15 07:53:12,829 INFO     2024-11-15 07:53:12 配置文件校验结果：
2024-11-15 07:53:12,829 INFO     2024-11-15 07:53:12 路径验证：通过
2024-11-15 07:53:12,829 INFO     2024-11-15 07:53:12 格式验证：通过
2024-11-15 07:53:12,829 INFO     2024-11-15 07:53:12 所需键验证：通过 (缺失键：无)
SECATS-安全测试评估工具🚀
请输入生成的威胁样本数量: 100
正在生成威胁样本🚀 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00
生成了 100 个威胁样本
是否保存威胁样本到 Parquet 文件？(y-是/n-否): y
保存了分块数据到文件：2024-11-15/web_attack_samples_part1.parquet, 行范围 0 到 100
请输入目标网站地址（域名或IP地址）: www.xxx.com
目标域名或IP地址 https://www.xxx.com 有效
是否使用代理池？(y-是/n-否): y
正在校验代理池中的代理🚀 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00
有效代理数量: 40
请选择线程类型🚀：
1. 推荐🚀-50
2. 快速🚀-100
3. 极速🚀-200
4. 自定义🚀
请输入线程选项（1-4）: 1
请输入每秒请求数（1-1000）: 10
正在执行任务 🚀   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 100/100 48.656412284006365
执行完毕🚀！成功次数: 85, 失败次数: 15
```
本工具具备以下特性，能够更高效、安全、自动化地进行网络请求测试与限速控制：

- **令牌桶算法**：基于经典的令牌桶算法实现请求流量控制，支持高并发环境下的稳定限速。
- **代理池管理**：管理多重代理池并对代理进行健康检测和评分维护，确保代理池内代理的高可用性。
- **HTTP 会话复用**：借助`requests.Session()`实现连接的复用，降低连接开销，提高并发请求的性能。
- **威胁请求样本生成**：自动生成不同 HTTP 方法的请求样本，用于压力测试或网络安全相关的合规测试。
- **多线程和限速控制**：提供灵活的多线程和请求速率限制设置，适用于各种请求量需求。
- **可配置的用户输入接口**：允许用户设定威胁请求数量、目标网站地址、是否使用代理池等，简单易用。
- **操作日志与结果记录**：在测试过程中自动记录成功和失败的请求，便于后续数据分析。

---

## 应用场景

该工具适用于以下场景：

1. **防火墙性能测试**
2. **安全威胁样本生成**
3. **压力测试和负载测试**
4. **自动化安全测试**

## 模块详解

### 令牌桶算法和速率限制器

通过`TokenBucket`和`RateLimiter`类实现的流量控制模块，用于精准控制请求速率。

#### TokenBucket

`TokenBucket`类实现了基础的令牌桶算法。通过设定容量和填充速率来控制请求流量，每秒自动填充固定数量的令牌供请求消耗，确保请求频率符合预设标准。

**主要属性和方法**：

- **`__init__`**：初始化令牌桶的容量和填充速率，适配不同的网络请求需求。
- **`refill`**：按预设速率填充令牌，确保令牌数量在高并发请求下得到有效补充。
- **`take`**：尝试从桶中取出令牌，若取出成功则允许请求执行，否则限制请求。

#### RateLimiter

`RateLimiter`类提供了一个简单的速率控制方法，可在低负载情况下替代`TokenBucket`进行限速控制，支持简单场景下的限速需求。

---

### 代理池管理器

`ProxyPoolManager`用于管理、更新和监控代理池中代理的可用状态和评分。可设置代理的初始评分、最大分值、最小分值等参数，保障高质量代理的自动选择。

**主要功能**：

- **`__init__`**：初始化代理池和代理评分系统，并加载预设代理。
- **`update_proxy_score`**：根据代理的请求成功率和失败率动态调整评分，剔除低评分的代理。
- **`get_best_proxy`**：根据评分获取高质量代理，确保使用最佳代理池。
- **`remove_proxy`**：自动清除低于设定分值的代理，保持代理池的高质量和稳定性。

#### 代理池健康检测

通过 `check_proxy_health` 函数验证代理池中的代理可用性，确保请求的成功率，筛选和记录有效代理。

---

### HTTP 会话管理

使用`get_shared_session`函数管理 HTTP 会话，基于 `requests.Session()`复用 TCP 连接，减少连接开销，提高请求性能。

- **会话池复用**：避免频繁建立连接，减少资源浪费，尤其在高并发场景下效果显著。
- **连接重试策略**：通过会话设置实现自动重试，提升请求的成功率和可靠性。

---

### 威胁样本生成与解析

**`generate_web_attack_samples`**和**`parse_sample`**函数用于模拟生成多种类型的 HTTP 请求样本，支持 GET、POST、PUT 等多种 HTTP 方法，可应用于网络威胁测试和模拟攻击流量。

- **威胁请求生成**：根据用户设定的样本数量生成不同方法的请求。
- **样本解析**：解析生成的请求样本，并提取 HTTP 请求的关键元素（方法、路径、头部、内容）供调用。

> 注意：生成的威胁请求样本仅限合法合规测试，切勿非法使用。

---

### 网络请求发送与代理使用

**`send_request_with_proxy`**：该方法负责发送 HTTP 请求并支持代理池调用，带有重试机制、超时控制和速率控制功能。

- **速率限制**：调用令牌桶控制请求频率，确保符合设定的请求流量。
- **代理轮换**：通过代理池动态选择最佳代理，减少被封禁的风险。
- **重试与超时设置**：若请求失败或超时，将重新尝试，确保请求发送的稳定性。

---

## 主程序流程

主程序提供用户交互接口，并按用户输入的配置项执行威胁测试请求。流程大致如下：

1. **输入威胁样本数量**：生成相应数量的威胁测试请求样本。
2. **验证目标 URL**：检查目标 URL 是否符合格式要求。
3. **选择是否使用代理池**：如启用代理池，则进行代理池健康检查，筛选出高质量代理。
4. **设置线程数和每秒请求数**：根据用户输入配置线程池和令牌桶。
5. **执行请求**：基于多线程池按设定速率执行请求。成功或失败的请求分别记录于不同的队列，便于后续统计分析。

> **中断保护**：捕获 “Ctrl+C” 中断信号，确保安全关闭所有线程和清空队列，防止未处理请求遗漏。

---
